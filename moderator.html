<!DOCTYPE html>
<html>
<body>

<h2>Панель модератора</h2>
<div id="list"></div>

<script type="module">
import { db } from "./firebase.js";
import { guard } from "./authGuard.js";
import { collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard("moderator");

const snap = await getDocs(collection(db, "users"));
const list = document.getElementById("list");

snap.forEach(docSnap => {
  const u = docSnap.data();
  if (u.situation !== "verified") return;
  if (u.role !== "player") return;

  const div = document.createElement("div");
  div.innerHTML = `
    ${u.nick} — 
    <input type="number" value="${u.points}">
    <button>Изменить</button>
  `;
  div.querySelector("button").onclick = async () => {
    await updateDoc(docSnap.ref, {
      points: Number(div.querySelector("input").value)
    });
  };
  list.appendChild(div);
});
</script>

</body>
</html>
