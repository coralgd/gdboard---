<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Панель старшего модератора</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<div id="list"></div>

<script type="module">
import { auth, db } from "./firebase.js";
import { guard } from "./authGuard.js";
import { collection, getDocs, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard({ requireVerified:true, role:"elder" });

const list = document.getElementById("list");
const snap = await getDocs(collection(db,"users"));

snap.forEach(docSnap=>{
  const u=docSnap.data();
  const div=document.createElement("div");
  div.className="panel metal";
  div.innerHTML=`
    <strong>${u.nick || u.email}</strong>
    <input type="number" value="${u.points || 0}">
    <button class="safe">Изменить очки</button>
    <button class="danger">
      ${u.situation==="blocked"?"Вернуть верификацию":"Снять верификацию"}
    </button>
    <button>
      ${u.role==="moderator"?"Снять модера":"Назначить модером"}
    </button>
  `;
  div.querySelector(".safe").onclick=()=>updateDoc(docSnap.ref,{points:Number(div.querySelector("input").value)});
  div.querySelector(".danger").onclick=()=>updateDoc(docSnap.ref,{situation:u.situation==="blocked"?"verified":"blocked"});
  div.querySelector("button:last-child").onclick=()=>updateDoc(docSnap.ref,{role:u.role==="moderator"?"player":"moderator"});
  list.appendChild(div);
});
</script>
</body>
</html>
