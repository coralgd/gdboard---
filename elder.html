<!DOCTYPE html>
<html>
<body>

<h2>Панель старшего модератора</h2>
<div id="list"></div>

<script type="module">
import { db } from "./firebase.js";
import { guard } from "./authGuard.js";
import {
  collection,
  getDocs,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard("elder");

const snap = await getDocs(collection(db, "users"));
const list = document.getElementById("list");

snap.forEach(docSnap => {
  const u = docSnap.data();

  const div = document.createElement("div");
  div.innerHTML = `
    ${u.nick || u.email}
    <input type="number" value="${u.points || 0}">
    <button class="points">Баллы</button>
    <button class="verify">${u.situation === "verified" ? "Снять верификацию" : "Верифицировать"}</button>
    <button class="mod">${u.role === "moderator" ? "Снять модера" : "Назначить модером"}</button>
  `;

  div.querySelector(".points").onclick = () =>
    updateDoc(docSnap.ref, { points: Number(div.querySelector("input").value) });

  div.querySelector(".verify").onclick = () =>
    updateDoc(docSnap.ref, {
      situation: u.situation === "verified" ? "blocked" : "verified"
    });

  div.querySelector(".mod").onclick = () =>
    updateDoc(docSnap.ref, {
      role: u.role === "moderator" ? "player" : "moderator"
    });

  list.appendChild(div);
});
</script>

</body>
</html>
