<!DOCTYPE html>
<html>
<head>
  <title>Лидерборд</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>

<div class="panel" id="board"></div>

<script type="module">
import { db } from "./firebase.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { guard } from "./authGuard.js";

guard();

const snap = await getDocs(collection(db,"users"));
const users = snap.docs
  .map(d=>d.data())
  .filter(u=>u.situation==="verified")
  .sort((a,b)=>b.points-a.points);

let place = 0, last = null;

users.forEach((u,i)=>{
  if (u.points !== last) place = i+1;
  last = u.points;

  const row = document.createElement("div");
  row.className = `row ${u.role}`;
  row.innerHTML = `
    <div>${place}</div>
    <div>${u.nick}</div>
    <div>${u.points}</div>
    <div>${u.role==="elder"?"Старший модер":u.role==="moderator"?"Модератор":""}</div>
  `;
  board.append(row);
});
</script>

<script src="hudBackground.js"></script>
</body>
</html>
