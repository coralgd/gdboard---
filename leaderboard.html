<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Лидерборд</title>
<link rel="stylesheet" href="styles.css">
</head>
<body class="center">
<div class="panel metal">
  <h2>Лидерборд</h2>
  <div id="list"></div>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { guard } from "./authGuard.js";
import { collection, getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard({ requireVerified: true });

const list = document.getElementById("list");
const snap = await getDocs(collection(db, "users"));
let arr = [];

snap.forEach(s => arr.push({ id: s.id, ...s.data() }));

arr.sort((a,b) => b.points - a.points);

let prevPoints = null, place = 0, displayPlace = 0;
arr.forEach(u => {
  place++;
  if(u.points !== prevPoints) displayPlace = place;
  prevPoints = u.points;

  const div = document.createElement("div");
  div.className = "panel metal";
  div.textContent = `${displayPlace}. ${u.nick || u.email} — ${u.points} баллов`;
  list.appendChild(div);
});
</script>
</body>
</html>
