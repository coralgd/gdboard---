<!DOCTYPE html>
<html>
<head>
  <title>Главная</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<canvas id="hud-bg"></canvas>

<div class="panel">
  <h2>Ваш статус</h2>
  <div id="info"></div>
  <button onclick="location.href='leaderboard.html'">Лидерборд</button>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { guard } from "./authGuard.js";
import { doc,getDoc,collection,getDocs } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard();

const me=await getDoc(doc(db,"users",auth.currentUser.uid));
const snap=await getDocs(collection(db,"users"));

const sorted=snap.docs.map(d=>d.data())
  .filter(u=>u.situation==="verified")
  .sort((a,b)=>b.points-a.points);

let place=sorted.findIndex(u=>u.uid===auth.currentUser.uid)+1;

info.innerHTML=`
  Баллы: ${me.data().points}<br>
  Место: ${place}
`;
</script>

<script src="hudBackground.js"></script>
</body>
</html>
