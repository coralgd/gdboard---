<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Главная</title>
<link rel="stylesheet" href="styles.css">
</head>
<body class="center">

<div class="panel metal">
  <h1>Главная</h1>
  <p id="userInfo">Загрузка...</p>
  <button onclick="location.href='leaderboard.html'">Лидерборд</button>
  <button id="checkRole">Проверить</button>
</div>

<script type="module">
import { auth, db } from "./firebase.js";
import { guard } from "./authGuard.js";
import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

guard({ requireVerified:true });

const info = document.getElementById("userInfo");

async function updateInfo(){
  const snap = await getDoc(doc(db,"users",auth.currentUser.uid));
  const u = snap.data();
  info.textContent = `${u.nick || ""} — ${u.points} баллов`;
}

updateInfo();

document.getElementById("checkRole").onclick = async () => {
  const snap = await getDoc(doc(db,"users",auth.currentUser.uid));
  const u = snap.data();
  if(u.role==="moderator") location.href="moderator.html";
  else if(u.role==="elder") location.href="elder.html";
  else alert("Ошибка: модерки нет");
};
</script>

</body>
</html>
